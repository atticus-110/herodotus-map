<!DOCTYPE html>
<html>
<head>
  <title>Herodotus Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #container {
      display: flex;
      height: 100vh;
      width: 100vw;
    }
    #sidebar {
      width: 220px;
      background: #f7f3e9;
      padding: 10px;
      overflow-y: auto;
      border-right: 1px solid #ccc;
      transition: transform 0.3s ease-in-out;
    }
    #sidebar.collapsed {
      transform: translateX(-100%);
    }
    #toggleSidebar {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: #fff;
      border: 1px solid #ccc;
      padding: 5px 10px;
      cursor: pointer;
    }
    #map {
      flex: 1;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="sidebar">
      <h2>Index</h2>
      <button onclick="showAll()">Show All</button>
      <ul>
        <li><a href="#" onclick="focusOn('io')">Io</a></li>
        <li><a href="#" onclick="focusOn('gyges')">Gyges</a></li>
        <li><a href="#" onclick="focusOn('europa')">Europa</a></li>
      </ul>
    </div>
    <div id="map"></div>
    <button id="toggleSidebar" onclick="toggleSidebar()">â˜°</button>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map', {
      center: [38, 25],
      zoom: 5
    });

    const ancientMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://carto.com/">CARTO</a>'
    }).addTo(map);

    const places = {
      argos: { coords: [37.6333, 22.7333], characters: ['Io'] },
      memphis: { coords: [29.8492, 31.2544], characters: ['Io'] },
      sardis: { coords: [38.4746, 28.0428], characters: ['Gyges'] },
      lydia: { coords: [38.7, 27.7], characters: ['Gyges'] },
      tyre: { coords: [33.2708, 35.2034], characters: ['Europa'] },
      crete: { coords: [35.2401, 24.8093], characters: ['Europa'] }
    };

    const stories = {
      io: {
        summary: "The Persians say that Io, daughter of King Inachus, was kidnapped by Phoenicians and taken to Egypt. Herodotus 1.1, 1.5",
        places: ['argos', 'memphis']
      },
      gyges: {
        summary: "Gyges, bodyguard of King Candaules, eventually became king of Lydia. Herodotus 1.7",
        places: ['sardis', 'lydia']
      },
      europa: {
        summary: "Europa, daughter of the king of Tyre, was abducted by Greeks, possibly Cretans. Herodotus 1.2",
        places: ['tyre', 'crete']
      }
    };

    const storyGroups = {
      io: L.layerGroup(),
      gyges: L.layerGroup(),
      europa: L.layerGroup()
    };

    const labelLayers = [];

    // Add place labels to map
    for (const key in places) {
      const p = places[key];
      const label = L.marker(p.coords, {
        icon: L.divIcon({ className: 'place-label', html: `<strong>${key.charAt(0).toUpperCase() + key.slice(1)}</strong>` })
      }).addTo(map);

      label.bindPopup(`Related characters:<br>${p.characters.map(c => `<a href='#' onclick=\"focusOn('${c.toLowerCase()}')\">${c}</a>`).join('<br>')}`);
      labelLayers.push(label);
    }

    // Draw story-specific routes
    storyGroups.io.addLayer(L.polyline([places.argos.coords, places.memphis.coords], {
      color: 'purple', weight: 3, dashArray: '5,5', opacity: 0.7
    }));

    storyGroups.europa.addLayer(L.polyline([places.tyre.coords, places.crete.coords], {
      color: 'blue', weight: 3, dashArray: '5,5', opacity: 0.7
    }));

    function focusOn(character) {
      clearAllStories();
      const group = storyGroups[character];
      if (group) group.addTo(map);

      const story = stories[character];
      const firstPlace = places[story.places[0]];
      const popup = L.popup()
        .setLatLng(firstPlace.coords)
        .setContent(`<strong>${character.charAt(0).toUpperCase() + character.slice(1)}:</strong><br>${story.summary}<br><br><a href='#' onclick=\"clearAllStories()\">Close</a>`)
        .openOn(map);

      const bounds = L.latLngBounds(story.places.map(p => places[p].coords));
      map.fitBounds(bounds);
    }

    function clearAllStories() {
      for (let key in storyGroups) {
        storyGroups[key].remove();
      }
      map.closePopup();
    }

    function showAll() {
      clearAllStories();
      map.setView([38, 25], 5);
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    }
  </script>
</body>
</html>
