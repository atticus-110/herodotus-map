<!DOCTYPE html>
<html>
<head>
  <title>Herodotus Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }

    #container {
      display: flex;
      height: 100vh;
      width: 100vw;
    }

    #sidebar {
      width: 240px;
      background: #f7f3e9;
      padding: 10px;
      overflow-y: auto;
      border-right: 1px solid #ccc;
      transition: width 0.3s ease, padding 0.3s ease;
    }

    #sidebar.collapsed {
      width: 0;
      padding: 0;
      overflow: hidden;
    }

    #toggleSidebar {
      position: absolute;
      left: 250px;
      top: 10px;
      z-index: 1001;
      background: #f7f3e9;
      border: 1px solid #ccc;
      padding: 4px 8px;
      cursor: pointer;
      transition: left 0.3s ease;
    }

    #sidebar.collapsed + #toggleSidebar {
      left: 10px;
    }

    #map {
      flex: 1;
    }

    .place-label {
      background-color: rgba(255, 255, 255, 0.7);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: auto;
      cursor: pointer;
    }

    .region-label {
      background-color: rgba(255, 255, 255, 0.5);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      color: #bbb;
      pointer-events: auto;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="sidebar">
      <h2>Index</h2>
      <button onclick="showAll()">Show All</button>
      <ul>
        <li><a href="#" onclick="focusOn('io')">Io</a></li>
        <li><a href="#" onclick="focusOn('gyges')">Gyges</a></li>
        <li><a href="#" onclick="focusOn('europa')">Europa</a></li>
      </ul>
    </div>
    <div id="toggleSidebar" onclick="toggleSidebar()">â˜°</div>
    <div id="map"></div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.getElementById('toggleSidebar');
      sidebar.classList.toggle('collapsed');
      toggle.style.left = sidebar.classList.contains('collapsed') ? '10px' : '250px';
    }

    const ancientMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://carto.com/">CARTO</a> Voyager No Labels',
    });

    const modernMap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    });

    const map = L.map('map', {
      center: [38, 25],
      zoom: 5,
      layers: [ancientMap]
    });

    const baseMaps = {
      "Ancient Style": ancientMap,
      "Modern Map": modernMap
    };
    L.control.layers(baseMaps).addTo(map);

    const ioGroup = L.layerGroup();
    const gygesGroup = L.layerGroup();
    const europaGroup = L.layerGroup();

    const stories = {
      io: {
        summary: "The Persians say that Io, daughter of King Inachus, was kidnapped along with some other women by Phoenician merchants, and taken to Egypt. The Phoenicians, however, claim that Io went willingly, being ashamed that she had become pregnant by the ship's captain. Herodotus 1.1, 1.5",
        places: ['argos', 'memphis']
      },
      gyges: {
        summary: "Gyges was the bodyguard of King Candaules of Lydia and eventually took over his throne. Herodotus 1.7",
        places: ['sardis', 'lydia']
      },
      europa: {
        summary: "Some of the Greeks landed in Tyre and abducted the king's daughter, Europa. These men may have been Cretans. Herodotus 1.2",
        places: ['tyre', 'crete']
      }
    };

    const places = {
      argos: { coords: [37.6333, 22.7333], name: "Argos", characters: ['Io'] },
      memphis: { coords: [29.8492, 31.2544], name: "Memphis", characters: ['Io'] },
      sardis: { coords: [38.4746, 28.0428], name: "Sardis", characters: ['Gyges'] },
      lydia: {
        polygon: [
          [38.4, 27.0], [38.9, 27.5], [38.7, 28.4], [38.0, 28.2], [37.7, 27.5], [38.0, 27.0]
        ],
        center: [38.4, 27.7],
        name: "Lydia",
        characters: ['Gyges']
      },
      tyre: { coords: [33.2708, 35.2034], name: "Tyre", characters: ['Europa'] },
      crete: { coords: [35.2401, 24.8093], name: "Crete", characters: ['Europa'] }
    };

    function characterLinks(charArray) {
      return 'Related characters:<br>' + charArray.map(ch =>
        `<a href="#" onclick="focusOn('${ch.toLowerCase()}')">${ch}</a>`).join('<br>');
    }

    function createLabel(placeKey, isRegion = false) {
      const place = places[placeKey];
      const icon = L.divIcon({
        className: isRegion ? 'region-label' : 'place-label',
        html: place.name,
        iconSize: null
      });
      const coords = place.coords || place.center;
      return L.marker(coords, { icon }).bindPopup(`<strong>${place.name}</strong><br>${characterLinks(place.characters)}`);
    }

    const ioRoute = L.polyline([
      places.argos.coords,
      places.memphis.coords
    ], { color: "purple", weight: 3, dashArray: "5,8", opacity: 0.7 });

    const europaRoute = L.polyline([
      places.tyre.coords,
      places.crete.coords
    ], { color: "blue", weight: 3, dashArray: "5,8", opacity: 0.7 });

    ioGroup.addLayer(createLabel('argos'));
    ioGroup.addLayer(createLabel('memphis'));

    gygesGroup.addLayer(createLabel('sardis'));
    gygesGroup.addLayer(L.polygon(places.lydia.polygon, {
      color: "gold", fillColor: "#f0e68c", fillOpacity: 0.3
    }));
    gygesGroup.addLayer(createLabel('lydia', true));

    europaGroup.addLayer(createLabel('tyre'));
    europaGroup.addLayer(createLabel('crete'));

    function focusOn(character) {
      // Clear all
      map.eachLayer(layer => {
        if (layer !== ancientMap && layer !== modernMap) map.removeLayer(layer);
      });

      if (character === 'io') {
        ioGroup.addTo(map);
        ioRoute.addTo(map);
        map.fitBounds(ioGroup.getBounds());
      } else if (character === 'gyges') {
        gygesGroup.addTo(map);
        map.fitBounds(gygesGroup.getBounds());
      } else if (character === 'europa') {
        europaGroup.addTo(map);
        europaRoute.addTo(map);
        map.fitBounds(europaGroup.getBounds());
      }

      showStory(character);
    }

    function showAll() {
      map.eachLayer(layer => {
        if (layer !== ancientMap && layer !== modernMap) map.removeLayer(layer);
      });

      ioGroup.addTo(map);
      gygesGroup.addTo(map);
      europaGroup.addTo(map);
      map.setView([38, 25], 5);
      clearStorySummary();
    }

    function showStory(character) {
      const story = stories[character];
      if (!story) return;
      const firstPlace = story.places[0];
      const latlng = places[firstPlace].coords || L.polygon(places[firstPlace].polygon).getBounds().getCenter();

      L.popup({ maxWidth: 400 })
        .setLatLng(latlng)
        .setContent(`<strong>${character.charAt(0).toUpperCase() + character.slice(1)}</strong><br>${story.summary}`)
        .openOn(map);
    }

    function clearStorySummary() {
      map.closePopup();
    }

    showAll();
  </script>
</body>
</html>
